<app-content-layout title="Ваш профиль" [left]="left" [main]="main"></app-content-layout>

<ng-template #left>
    <app-user-info [user]="profile"></app-user-info>
</ng-template>

<ng-template #main>
    <nz-table nzTemplateMode>
        <tbody>
            <tr>
                <td>Profile</td>
                <td>{{ profile?.firstName }} {{ profile?.lastName }}</td>
                <td><a (click)="showProfile = !showProfile">Edit</a></td>
            </tr>
            <tr>
                <td>Phone</td>
                <td>{{ profile?.phone }}</td>
                <td class="cell-action">
                    <div *ngIf="profile.phone && !profile.isPhoneVerified">
                        <a (click)="showConfirmPhone = !showConfirmPhone">Confirm</a>
                        <span class="cell-action__separate">/</span>
                    </div>
                    <a (click)="showPhone = !showPhone">Change</a>
                </td>
            </tr>
        </tbody>
    </nz-table>
</ng-template>

<nz-modal [(nzVisible)]="showProfile" (nzOnCancel)="showProfile = !showProfile" (nzOnOk)="submitForm(profileForm.NAME)">
    <form nz-form [formGroup]="formName" [nzLayout]="'vertical'">
        <div class="user-avatar">
            <nz-upload
                nzAction="/s3/image"
                nzListType="picture-card"
                [nzFileList]="file"
                nzAccept="image/png, image/jpeg"
                [nzLimit]="1"
                (nzChange)="fileChanged($event)"
            >
                <div>
                    <i nz-icon nzType="plus"></i>
                    <div style="margin-top: 8px;">Upload</div>
                </div>
            </nz-upload>
        </div>

        <nz-form-item>
            <nz-form-control [nzSpan]="14">
                <input nz-input name="firstName" type="text" formControlName="firstName" />
            </nz-form-control>
        </nz-form-item>
        <nz-form-item>
            <nz-form-control [nzSpan]="14">
                <input nz-input name="lastName" type="text" formControlName="lastName" />
            </nz-form-control>
        </nz-form-item>
    </form>
</nz-modal>

<nz-modal [(nzVisible)]="showPhone" nzTitle="Номер" (nzOnCancel)="showPhone = !showPhone" (nzOnOk)="submitForm(profileForm.PHONE)">
    <form nz-form [formGroup]="formPhone">
        <nz-form-item>
            <nz-form-label for="phone">
                Изменить номер телефона
            </nz-form-label>
            <nz-form-control [nzSpan]="14">
                <input
                    type="text"
                    nz-input
                    name="phone"
                    id="phone"
                    type="text"
                    prefix="+7 "
                    mask="(000) 000 00 00"
                    formControlName="phone"
                />
            </nz-form-control>
        </nz-form-item>
    </form>
</nz-modal>

<nz-modal
    [(nzVisible)]="showConfirmPhone"
    nzTitle="Code"
    (nzOnCancel)="showConfirmPhone = !showConfirmPhone"
    (nzOnOk)="submitForm(profileForm.CONFIRM)"
>
    <form nz-form [formGroup]="formConfirm">
        <nz-button-group>
            <button *ngIf="!confirmMode" nz-button nzType="primary" (click)="requestVerification()" nzSize="small">
                Подтвердить
            </button>
        </nz-button-group>
        <nz-form-item *ngIf="confirmMode">
            <nz-form-label for="code">
                enter the code from sms
            </nz-form-label>
            <nz-form-control [nzSpan]="14">
                <input type="number" nz-input name="code" id="code" formControlName="code" />
            </nz-form-control>
        </nz-form-item>
    </form>
</nz-modal>
